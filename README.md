# restful-api-spring
This is a API developed using Spring, integrated with Spring Security. 
This API consists of 2 main entities, Customers and Users. First ones are those whose information is registered in the 
platform but cannot access the API. Last ones are users that have a username, a password and can have diferent roles. 

## Installation and Getting Started
This is a Spring Boot application, containing all the dependencies in a pom.xml file(Maven project). This means that the API can work as a standalone .jar application or a .war file can be generated to be traditionaly deployed.
To download this project just clone it into intelliJ Idea, wait for the dependencies to be imported and run it.

## Running the application

The main class of all this project is:

```java
@SpringBootApplication
  public class ProjectApplication {
      public static void main(String[] args) {
          SpringApplication.run(ProjectApplication.class, args);
      }
  }
```
When you run the project by this start point, the entire API start to work.

## The Database
The database used for this API is an embedded "h2" database. This is the one used for reasons of availability. To change the database used you just need to change some lines in the **application.properties** file found in the resources package of the project.
The database is initialized with a minimum data, which consists in 2 customers and 1 user with both Admin and User roles.
To initialize the "h2" database with some data, queries must be writen in a file named "data.sql" found in the resources package of the project, which looks like:
```sql
INSERT INTO user VALUES(1,'$2a$04$2/y1i84w03REpz.t1nTaYeFsgwaK7FnYnEwdEVLX79cQjHvOglg4u','username')
INSERT INTO customer VALUES(1,'user1',null,'Miguel','http://localhost:8080/resources/images/imagesPhotoPerson1','Pérez')
INSERT INTO customer VALUES(2,'user1',null,'Alberto','http://localhost:8080/resources/images/imagesPhotoPerson2','Rodríguez')
INSERT INTO roles VALUES(1,'ROLE_ADMIN')
INSERT INTO roles VALUES(2,'ROLE_USER')
INSERT INTO user_roles VALUES(1,1)
INSERT INTO user_roles VALUES(1,2)
```
**Note:** The password field of the user is "$2a$04$2/y1i84w03REpz.t1nTaYeFsgwaK7FnYnEwdEVLX79cQjHvOglg4u", which is the encoded password **pass123**

## The API
As mentioned above, this API consists of Customers and Users. Only the last ones can use the API, because it is protected with username and password. By default, there is a user created with "USER" and "ADMIN" roles:
- **Username:** username
- **Password:** pass123

A user with "USER" role can manage the customer data. Upload images are allowed too.
A user with "ADMIN" role can perform "USER" actions and additionally  manage users data.
Note that the possible requests that can be made are the CRUD operations:

#### GET all users/customers
`GET http://localhost:8080/customers`
`GET http://localhost:8080/users`
#### GET specific user/customer
`GET http://localhost:8080/customers/1`
`GET http://localhost:8080/users/1`
Note that the the number passed in the path is the "id" of the element user/customer. 
#### POST any user/customer/image
`POST http://localhost:8080/customers`
`POST http://localhost:8080/users`
`POST http://localhost:8080/upload`
#### DELETE a user/customer
`DELETE http://localhost:8080/customers/2`
`DELETE http://localhost:8080/users/1`
#### PUT: update a user/customer
`PUT http://localhost:8080/customers`
`PUT http://localhost:8080/users`
To update a customer or a user the "id" must be specified in the json sent.

The requests to POST or PUT a user or a customer data must be sent as a Json file with at least the required fields (columns with nullable = false). "IDs" are being generated by the database, values sent in POST requests are being replaced for the values generated by the database.

To **change user roles**, it must be performed by a PUT request to the users, specifying the identifier of the user to be changed, settings the roles as needed.

In order to test the API, the program used to make requests is Postman https://www.getpostman.com/ .
